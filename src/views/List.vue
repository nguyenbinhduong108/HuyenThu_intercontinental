<template>
  <div id="box"></div>
  <header id="header">
    <div class="brandLogoNavContainer">
      <a class="logo" href="/">
        <img
          src="../../public/assets/logo-dark.svg"
          alt="InterContinental Hanoi Westlake Logo"
          width="200"
          height="80"
          title="InterContinental Hanoi Westlake"
          class="dark-logo"
        />
      </a>
    </div>
  </header>
  <div id="main">
    <div class="container">
      <div class="banner">
        <div class="wrapper">
          <div class="app-logo">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="121"
              height="25"
              viewBox="0 0 121 25"
              fill="currentColor"
              role="img"
              aria-label="IHG One Rewards"
            >
              <path
                d="M20.4984 4.5892H22.7819V19.7299H20.4984V12.8139H12.241V19.7299H9.9771V4.5892H12.241V11.25H20.4984V4.5892ZM1 4.5892H3.26391V19.7299H1V4.5892ZM39.0153 12.4409H41.3053V18.7419C40.2781 19.0363 38.3806 19.9785 35.9335 19.9785C30.9935 19.9785 27.6107 16.707 27.6107 12.2054C27.6107 8.08976 30.7448 4.34056 35.8877 4.34056C38.0142 4.34056 40.0491 4.81821 40.7819 5.00142V7.63175H40.6707C39.6434 6.3493 38.2497 5.2108 35.8026 5.2108C32.2563 5.2108 30.1298 8.27296 30.1298 12.0025C30.1298 15.9611 32.5507 19.0887 36.0971 19.0887C37.3075 19.0887 38.3871 18.7484 39.0218 18.3101V12.4409H39.0153Z"
                fill="currentColor"
                stroke="currentColor"
                stroke-width="0.25"
              ></path>
              <path
                d="M56.4132 9.58816V3.4246H55.7327C55.7327 4.8837 54.9148 7.16067 53.7175 9.08433C52.3761 11.237 50.8778 12.4736 49.6084 12.4736V13.1541C52.3761 13.1541 54.3391 12.4213 55.7327 11.2697V21.6536H56.4132V10.635C57.4405 9.54889 58.0817 8.20102 58.4808 6.79426V24.1596H59.1613V0.159607H58.4808C58.4808 3.79101 58.134 7.25883 56.4132 9.58816ZM55.7327 10.3733C54.784 11.309 53.5146 11.9829 51.8265 12.2839C52.6706 11.6492 53.5146 10.6874 54.2932 9.44423C54.8756 8.50857 55.3729 7.48782 55.7327 6.50636V10.3733Z"
                fill="currentColor"
                stroke="currentColor"
                stroke-width="0.25"
              ></path>
              <path
                d="M68.675 7.46162V7.39621C68.675 5.79316 70.1341 4.53034 72.3849 4.53034C74.6357 4.53034 76.0949 5.79314 76.0949 7.38311V7.44852C76.0949 9.04504 74.6357 10.3209 72.4045 10.3209C70.1734 10.3209 68.6685 9.04505 68.6685 7.46162H68.675ZM75.3293 7.43547V7.37001C75.3293 6.11374 74.2497 5.08648 72.3849 5.08648C70.5201 5.08648 69.4405 6.04832 69.4405 7.38311V7.44852C69.4405 8.80948 70.6576 9.7386 72.4111 9.7386C74.1646 9.7386 75.3293 8.78988 75.3293 7.43547Z"
                fill="currentColor"
                stroke="currentColor"
                stroke-width="0.25"
              ></path>
              <path
                d="M77.7373 4.60223H78.7057L82.782 9.40486V4.60223H83.4821V10.2489H82.6315L78.4374 5.26963V10.2489H77.7373V4.60223Z"
                fill="currentColor"
                stroke="currentColor"
                stroke-width="0.25"
              ></path>
              <path
                d="M85.5103 4.60231H90.2605V5.17155H86.2431V7.07557H89.6324V7.64485H86.2431V9.67974H90.4503V10.249H85.5103V4.60231Z"
                fill="currentColor"
                stroke="currentColor"
                stroke-width="0.25"
              ></path>
              <path
                d="M69.0869 14.0767H71.7696C73.0259 14.0767 74.0858 14.5413 74.0858 15.7322V15.7649C74.0858 16.7463 73.2548 17.2305 72.4697 17.3745L74.5373 19.7169H73.654L71.6322 17.4268H69.8263V19.7169H69.0934V14.0702L69.0869 14.0767ZM71.8219 16.8772C72.7641 16.8772 73.353 16.4912 73.353 15.7714V15.7387C73.353 14.9339 72.7118 14.6329 71.8219 14.6329H69.8263V16.8772H71.8219Z"
                fill="currentColor"
                stroke="currentColor"
                stroke-width="0.25"
              ></path>
              <path
                d="M76.1208 14.0766H80.8711V14.6458H76.8537V16.5499H80.243V17.1191H76.8537V19.154H81.0609V19.7233H76.1208V14.0766Z"
                fill="currentColor"
                stroke="currentColor"
                stroke-width="0.25"
              ></path>
              <path
                d="M82.2781 14.0767H83.0305L84.699 18.8466L86.6423 14.0767H87.1658L89.0698 18.8597L90.7972 14.0767H91.4842L89.4166 19.7233H88.723L86.8975 15.0778L84.9869 19.7233H84.2999L82.2846 14.0767H82.2781Z"
                fill="currentColor"
                stroke="currentColor"
                stroke-width="0.25"
              ></path>
              <path
                d="M94.638 14.0767H95.6194L98.3087 19.7233H97.5497L96.7841 18.1072H93.3817L92.6031 19.7233H91.9226L94.638 14.0767ZM93.65 17.551H96.5224L95.1025 14.5478L93.65 17.551Z"
                fill="currentColor"
                stroke="currentColor"
                stroke-width="0.25"
              ></path>
              <path
                d="M99.8789 14.0767H102.562C103.818 14.0767 104.878 14.5412 104.878 15.7321V15.7648C104.878 16.7463 104.047 17.2305 103.262 17.3744L105.329 19.7168H104.446L102.424 17.4267H100.618V19.7168H99.8854V14.0701L99.8789 14.0767ZM102.614 16.8771C103.556 16.8771 104.145 16.4911 104.145 15.7713V15.7386C104.145 14.9338 103.504 14.6329 102.614 14.6329H100.618V16.8771H102.614Z"
                fill="currentColor"
                stroke="currentColor"
                stroke-width="0.25"
              ></path>
              <path
                d="M106.913 14.0766H109.478C111.899 14.0766 113.077 15.274 113.077 16.8508V16.9228C113.077 18.4866 111.945 19.7233 109.452 19.7233H106.906V14.0766H106.913ZM109.432 19.154C111.375 19.154 112.324 18.2838 112.324 16.9098V16.8443C112.324 15.5423 111.474 14.6328 109.426 14.6328H107.646V19.1475H109.432V19.154Z"
                fill="currentColor"
                stroke="currentColor"
                stroke-width="0.25"
              ></path>
              <path
                d="M114.45 18.0025H115.17C115.288 18.6961 115.818 19.2326 117.323 19.2326C118.533 19.2326 119.207 18.8204 119.207 18.1334C119.207 17.4464 118.71 17.2566 117.159 17.0734C115.602 16.8902 114.738 16.5238 114.738 15.5096C114.738 14.6394 115.648 14.0047 117.133 14.0047C118.618 14.0047 119.541 14.5282 119.691 15.562H119.017C118.841 14.8291 118.226 14.5674 117.133 14.5674C115.942 14.5674 115.425 14.9338 115.425 15.4965C115.425 16.0004 115.798 16.2948 117.375 16.478C119.03 16.6678 119.92 17.0015 119.92 18.1138C119.92 19.0952 118.958 19.7953 117.323 19.7953C115.425 19.7953 114.588 18.9971 114.45 18.0025Z"
                fill="currentColor"
                stroke="currentColor"
                stroke-width="0.25"
              ></path>
            </svg>
          </div>
          <div class="vl"></div>
          <div class="pointer">
            <b class="underline">Book</b> from <b>6,500</b> points
          </div>
        </div>
      </div>

      <BookingCard v-for="room in rooms" :key="room.id" :id="room.id" @idSelect="handleViewDetails"/>
    </div>
  </div>

  <footer>
    <div class="container">
      <div class="drawer">Giá phản ánh mức giá trung bình mỗi đêm cho một phòng.</div>
      <!-- <div class="drawer">Rates reflect average nightly rate for one room.</div> -->
      <div class="text">
        <p>
          Để tính Giá trung bình mỗi đêm, hãy cộng giá cho mỗi đêm lưu trú của bạn 
          và chia tổng cho số đêm lưu trú của bạn. Bạn có thể tìm thấy giá riêng cho 
          mỗi đêm trên trang thông tin giá và xác nhận giá.
        </p>
        <p>
          Xin lưu ý: Việc kéo dài hoặc giảm số đêm lưu trú của bạn sẽ ảnh hưởng 
          đến Giá trung bình mỗi đêm. Bạn sẽ chịu trách nhiệm về mức giá được 
          xác định theo số đêm thực tế lưu trú của bạn.
        </p>
        <!-- <p>
          To calculate the Average Nightly Rate, add the rates for each night of
          your stay and divide the total by the number of nights in your stay.
          The individual nightly rates can be found on the rate information and
          confirmation pages.
        </p>
        <p>
          Please note: Extending or reducing the number of nights in your stay
          will affect the Average Nightly Rate. You will be responsible for the
          rate that is determined by the actual number of nights in your stay.
        </p> -->
      </div>

      <div class="back-to-top">
        <button @click="handleBackToTop">
          Quay lại đầu trang
        </button>
        <!-- <button @click="handleBackToTop">
          Back to Top
        </button> -->
      </div>

    </div>
  </footer>

  <DetailForm v-if="isShowDetailForm" @closeForm="handleCloseForm" :id="idSelect"/>
</template>

<script setup lang="ts">
import DetailForm from '@/components/DetailForm.vue';
import BookingCard from '@/components/BookingCard.vue';
import { ref, onMounted } from 'vue';
import axios from "axios";
import { useDatesStore } from '@/stores/dates'
//biến 
const isShowDialog = ref<boolean>(false)

const isShowDetailForm = ref<boolean>(false);
const rooms = ref<any>([]);
const idSelect = ref<string>('');

const roomNumber = ref<string>('');

//xử lý hàm
const handleViewDetails = (id: string) => {
  idSelect.value = id;
  isShowDetailForm.value = true
}

const handleCloseForm = () => {
  isShowDetailForm.value = false
}

const getRoom = async () => {
  return await axios.get('http://localhost:8081/hotelmaster/room');
}
const useDates = useDatesStore();
const getRoomWithDates = async () => {
  return await axios.get(`http://localhost:8081/hotelmaster/room/available-in-range?startDate=${useDates.checkIn}&endDate=${useDates.checkOut}`);
}


import { useRoomStore } from "@/stores/rooms";
const useRoom = useRoomStore()

onMounted(async () => {
  if(useDates.checkIn == '' || useDates.checkOut == ''){
    rooms.value = (await getRoom()).data;
  }
  else if(useDates.checkIn != '' && useDates.checkOut != ''){
    rooms.value = (await getRoomWithDates()).data;
  } 
} );

const handleBackToTop = () => {

}


const handleBooking = () => {
  isShowDialog.value = true;
  axios.post('http://localhost:8081/hotelmaster/booking', {
        "username": null,
        "roomNumber": roomNumber,
        "checkInDate": "2024-02-02",
        "checkOutDate": "2024-02-02",
        "totalPrice": 10000,
        "bookingStatus": "BOOKED"
  })
}
</script>

<style lang="scss" scoped>
  @font-face {
    font-family: "Graphik Semibold";
    src: url(../assets/fonts/Graphik-Regular-Web.woff2);
    font-weight: 400;
  }

  @font-face {
    font-family: "Graphik Semibold";
    src: url(../assets/fonts/Graphik-Medium-Web.woff2);
    font-weight: 500;
  }

  @font-face {
    font-family: "Graphik Semibold";
    src: url(../assets/fonts/Graphik-Semibold-Web.woff2);
    font-weight: 600;
  }

  * {
    font-family: "Graphik Semibold";
    font-weight: 400;
  }

  #box {
    background-color: #f5f5f5;
    height: 100vh;
    position: fixed;
    inset: 0;
    z-index: -10;
  }

  header {
    background-color: white;
    padding: 20px 0px;
    margin-bottom: 40px;

    .brandLogoNavContainer {
      margin: 0 178.5px;
    }
  }

  #main {
    .container {
      margin: 0 178.5px;

      .banner {
        color: white;
        padding: 16px;
        margin: 20px 0;
        background-color: #204357;
        border-radius: 8px;
        height: auto;

        .wrapper {
          display: flex;
          flex-direction: row;
          align-items: center;
          gap: 15px;
          height: 100%;
          .app-logo {
            display: flex;
            justify-content: center;
          }

          .vl {
            background-color: white;
            height: 25px;
            width: 1px;
          }

          .pointer {
            .underline {
              font-weight: 600;
              text-decoration: underline;
            }
          }
        }
      }

      .booking {
        .room-rate-container {
          border-radius: 10px;
          margin-bottom: 20px;
          background: #fff;
          display: flex;
          flex-direction: column;
          overflow: hidden;

          .room-rate-card {
            display: flex;

            .roomPhotos {
              width: 280px;
              height: 210px;
              margin-right: 20px;
              background-color: #1f4456;
              overflow: hidden;

              img {
                width: 280px;
                height: 210px;
                object-fit: cover;
              }
            }

            .roomInfoPrice {
              display: flex;
              flex: 1;
              padding-top: 20px;

              .roomInfo {
                h2 {
                  font-size: 24px;
                  color: #363434;
                  word-break: break-word;
                  font-weight: 600;
                  line-height: 28px;
                  letter-spacing: 0px;
                  text-align: left;
                  margin-bottom: 8px;
                }

                .room-info-details {
                  display: flex;
                  flex-direction: column;
                  gap: 20px;
                  .room-attributes {
                    display: flex;
                    gap: 20px;
                    label {
                      margin-left: 5px;
                      color: #555;
                    }
                  }

                  .roomDetails {
                    text-decoration: underline;
                    background: none;
                    color: #204357;
                    border: none;
                    padding: 0;
                    cursor: pointer;
                    outline: none;
                    font-weight: 600;
                  }
                }
              }

              .roomPrice {
                padding-right: 10px;
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: end;
                .discount {
                  display: flex;
                  justify-content: end;
                  .rate-price-component {
                    text-align: right;
                    .member-discount {
                      color: #b38b7a;
                      font-weight: 600;
                    }
                    .from-pr {
                      color: #555;
                      font-size: 12px;
                    }
                    .to-price {
                      font-size: 24px;
                      font-weight: 600;
                      span {
                        font-size: 14px;
                        font-weight: inherit;
                      }
                    }

                    .per-night {
                      color: #555;
                      font-size: 12px;
                    }
                    .taxes {
                      margin-top: 5px;
                      font-size: 14px;
                    }
                  }
                }

                .action {
                  display: flex;
                  justify-content: end;
                  margin-top: 8px;

                  button {
                    padding: 15px;
                    background-color: #b38b7a;
                    font-weight: 600;
                    color: #fff;
                    border: unset;
                    outline: unset;
                    border-radius: 8px;
                    min-width: 150px;
                    min-height: 45px;
                    cursor: pointer;
                    transition: 350ms ease-in-out;

                    &:hover{
                      color: #fff;
                      background: #44443C;
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }

  .roomPrice-component {
    display: flex;
    flex-direction: column;
  }

  footer {
    .container {
      margin: 0 178.5px;
      .drawer {
        text-align: center;
        font-size: 18px;
        line-height: 24px;
        font-weight: 500;
        color: #3f3d3d;
      }

      .text {
        margin-top: 20px;
        p {
          font-size: 16px;
          font-weight: 400;
          text-align: center;
          margin-bottom: 1rem;
          color: #3f3d3d;
        }
      }

      .back-to-top{
        text-align: center;
        button{
          width: 328px;
          height: 42px;
          font-weight: 600;
        }
      }


    }
  }

  .dialog-123{
    position: fixed;
    inset: 0;
    background-color: rgba($color: #000000, $alpha: .2);
  }

  .dialog-123 div{
    background-color: #fff;
    padding: 10px;
    border-radius: 8px;
    position: relative;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 310px;

    button {
                    padding: 15px;
                    width: 100%;
                    background-color: #b38b7a;
                    font-weight: 600;
                    color: #fff;
                    border: unset;
                    outline: unset;
                    border-radius: 8px;
                    min-width: 150px;
                    min-height: 45px;
                    cursor: pointer;
                    transition: 350ms ease-in-out;
                    &:hover{
                      color: #fff;
                      background: #44443C;
                    }
  }
}
</style>
